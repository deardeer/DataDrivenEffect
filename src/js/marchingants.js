!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t){e.exports=function(e){return this._functionHub=e,this._mapDomMetaInfo={},this._mapDomOffsetAntMap={},this._liIntervals=[],this._liIntervalInfo=[],this.clearAnimateDomsbyIndex=function(e){this._mapDomMetaInfo[e]={},this._mapDomOffsetAntMap={}},this.update=function(e,t,n){this._mapDomMetaInfo[e]=n,this._mapDomOffsetAntMap[e]={}},this.addMetaInfo=function(e,t){null!=t&&(this._mapDomMetaInfo[e]=t)},this.updateMetaInfo=function(e,t){this._mapDomMetaInfo[e]=t},this.resetMetaInfo=function(e,t){var n=this._mapDomOffsetAntMap[e];Object.values(n).forEach(function(e){e.remove()}),this._mapDomOffsetAntMap[e]={},this._mapDomMetaInfo[e]=t},this.removeAntsbyIndex=function(e){for(var t=this._mapDomOffsetAntMap[e],n=Object.keys(t),i=0;i<n.length;i++){var o=t[n[i]];null!=o&&o.remove()}},this.getMetaInfos=function(){return this._mapDomMetaInfo},this.getMetaInfobyIndex=function(e){return this._mapDomMetaInfo[e]},this.getAnt=function(e,t){var n=void 0,i=this._mapDomOffsetAntMap[e];return null==i?(n=this.createAnt(e,t),this.addAnt(e,t,n)):null==(n=i[t])&&(n=this.createAnt(e,t),this.addAnt(e,t,n)),n},this.createAnt=function(e,t){var n,i=this.getMetaInfobyIndex(e),o=i.antmodel,r=i.boundaryPath,a=i.perimeter,l=i.cenPosDisplace,s=i.dots.join(";"),c=i.lengthperlist,u=i.normalanglelist,d=i.liuninormalvector,h=o.clone(),m=function(e,t,n){for(var i=t.length-2,o=0;o<t.length;o++)if(+t[o]>=n){i=0==o?0:o-1;break}var r=i+1,a=(n-+t[i])/(+t[r]-+t[i]);return{pos:function(e,t,n){var i=t.x-e.x,o=t.y-e.y;return{x:e.x+i*n,y:e.y+o*n}}({x:+e.split(";")[i].split(",")[0],y:+e.split(";")[i].split(",")[1]},{x:+e.split(";")[r].split(",")[0],y:+e.split(";")[r].split(",")[1]},a),beginIndex:i}}(s,c,t/a),f=m.pos,g=m.beginIndex;return f.x+=l*d[g][0],f.y+=l*d[g][1],h.position=new Point(f.x,f.y),h.rotate(-u[g]),(n=null!=r?h.intersect(r):h.clone()).visible=!0,h.remove(),n},this.addAnt=function(e,t,n){null==this._mapDomOffsetAntMap[e]?this._mapDomOffsetAntMap[e]={offset:n}:this._mapDomOffsetAntMap[e][t]=n},this.clearAnimateIntervals=function(){console.log(" clear ",this._liIntervalInfo);for(var e=0;e<this._liIntervals.length;e++)clearInterval(this._liIntervals[e]);this._liIntervals=[]},this.addAnimateIntervals=function(e){this._liIntervals.push(e)},this.newAnimateIntervalInfo=function(e){return this._liIntervalInfo[e]={},this._liIntervalInfo[e]},this}},function(e,t){e.exports=function(e){var t=this;return this._functionHub=e,this._currentEditGeometryType=void 0,$("#groupid").on("input",function(){var e=this.value;if(NaN!=e){var n=document.querySelector("#groupli-"+e+" span");if(null!=n){var i=+n.innerText;console.log(" ma list ",i),console.log(" !!! ",t._functionHub._animateDomManager._mapDomMetaInfo);var o=t._functionHub._animateDomManager.getMetaInfobyIndex(i);console.log("maInfo_previous ",o),document.getElementById("interval").value=+o.antinterval,document.getElementById("manual-antgap").value=+o.antgap,document.getElementById("antcolor").jscolor.fromString(o.antcolor),document.getElementById("groupid").value=o.groupid}}}),this.addMADoms=function(e,n){var i=e,o=(document.getElementById("maarea"),document.getElementById("magroupul"),document.getElementById("groupli-"+n.groupid));if(null==o){n.groupid;n.groupid,n.groupid}else o.innerHTML+="<span> "+i+"</span>";d3.selectAll(".mabutton").on("click",function(){var e=d3.select(this).attr("groupid"),n=[];document.querySelectorAll("#groupli-"+e+" span").forEach(function(e){n.push(+e.innerText)}),console.log(" ma list ",n);var i=t._functionHub._animateDomManager.getMetaInfobyIndex(n[0]);t.editAnimate(i,n)})},this.editGroupAnimate=function(e){},this.editAnimate=function(e,n){if(null!=n&&0!=n.length||null!=t._functionHub._geometrySaver.getCurrentMAGeometry()){null!=e&&(document.getElementById("interval").value=+e.antinterval,document.getElementById("manual-antgap").value=+e.antgap,document.getElementById("antcolor").jscolor.fromString(e.antcolor),document.getElementById("groupid").value=e.groupid);var i=document.getElementById("aeModal");i.style.display="block",document.getElementById("aecancel").onclick=function(){i.style.display="none"},document.getElementById("aeok").onclick=function(){var e,o,r;if(e={ae:"MA",groupid:document.getElementById("groupid").value,antgap:+document.getElementById("manual-antgap").value<.05?.05:+document.getElementById("manual-antgap").value,antshape:$('input[name="anttype"]:checked').val(),antcolor:"#"+document.getElementById("antcolor").value,antinterval:+document.getElementById("interval").value},i.style.display="none",null==n||0==n.length){o=t._functionHub._geometrySaver.getCurrentMAGeometry(),r=t._functionHub._geometrySaver.addMAGeometry(o);var a=t._functionHub._animateEnhancer.activateDOM(o,e).metainfo;t._functionHub._geometrySaver.clearCurrentMAGeometry(),d3.selectAll(".define_geometry").style("visibility","hidden"),t._functionHub._animateDomManager.addMetaInfo(r,a),t.addMADoms(r,a)}else for(var l=0;l<n.length;l++)r=n[l],o=t._functionHub._geometrySaver.getMAGeometrybyIndex(r),a=t._functionHub._animateEnhancer.activateDOM(o,e).metainfo,t._functionHub._animateDomManager.resetMetaInfo(r,a);t._functionHub._type="animate",t._functionHub.initFunc()}}else alert("Marching Ant Definer Error ")},this}},function(e,t){e.exports=function(){return this.activateDOM=function(e,t){switch(t.ae){case"MA":return this.marchingAnt(e,t)}},this.marchingAnt=function(e,t){var n=e.path,i=e.boundary,o=e.ant,r=+t.antinterval,a={cenPosDisplace:0},l=void 0;if(null!=i){l=new Path;for(var s=i.geometry,c=0;c<s.length;c++)l.add(new Point(s[c]));l.closed=!0,l.visible=!1}var u,d,h=n.geometry,m=n.lengthperlist,f=[],g=[],p=!0,y=n.liUniNormal_right,v=n.liUniNormal_left,_=n.perimeter,M=+t.antgap,b=t.antshape;if("self-defined"==b){u=null!=o&&null!=o.paperdom?o.paperdom.clone():new Path(o.geometry),console.log("antDom",o,u);var I=[u.position._x-h[0][0],u.position._y-h[0][1]],A=v[0],x=!0;I[0]*A[0]+I[1]*A[1]<0&&(x=!1),x?(g=v,f=n.liClockAngle_left):(p=!1,g=y,f=n.liClockAngle_right);var w=[h[1][0]-h[0][0],h[1][1]-h[0][1]],D=Math.sqrt(w[0]*w[0]+w[1]*w[1]),k=Math.sqrt(I[0]*I[0]+I[1]*I[1]),C=(w[0]*I[0]+w[1]*I[1])/D,P=Math.sqrt(k*k-C*C);a.cenPosDisplace=P,console.log("firstSegLength",D),console.log("cenPosLength",k),console.log("b1",C),console.log("antDomInfo",a);var S=[u.bounds.topLeft,u.bounds.topRight,u.bounds.bottomRight,u.bounds.bottomLeft];for(d=1e6,c=0;c<S.length;c++){var G=S[c],E=[G.x-h[0][0],G.y-h[0][1]],N=(E[0]*w[0]+E[1]*w[1])/D;d>N&&(d=N)}u.rotate(f[0]),d=d<0?-d:d,u.fillColor="black"}else"rect"==b?d=(u=new Path.Rectangle({position:new Point(0,0),size:new Size(5,50),fillColor:"black"})).bounds.width:"circle"==b?((u=new Path.Circle(new Point(0,0),20)).fillColor="black",d=u.bounds.width):((u=new Path([[-9.463,25.068],[-8.729,-25.067],[25.166,0]])).closed=!0,u.fillColor="black",d=u.bounds.width);for(var H=0,O=[];!(H>_);)O.push(H),H+=M;return u.fillColor=t.antcolor,u.opacity=.6,u.visible=!1,{metainfo:{antmodel:u,antwidth:d,antdots:o.geometry,antoffsets:O,cenPosDisplace:a.cenPosDisplace,dots:h,lengthperlist:m,normalanglelist:f,normalLeft:p,liuninormalvector:g,perimeter:_,antinterval:r,antgap:M,groupid:t.groupid,antcolor:t.antcolor,boundaryPath:l}}},this}},function(e,t){e.exports=function(){var e=this;return this._geometryType=null,this._newClick=!0,this._currectSelectId=null,this._validNextId=0,this._moveVertex=!1,this._moveCenter=!1,this._resizeCenter=!1,this._rotateCenter=!1,this._init=function(){},this.beginMode=function(e){this.clearMode(),this._geometryType=e.geotype;var t=e.liGeometryPos;null!=e.type&&(document.querySelectorAll("#geometryFinish input").forEach(function(e){e.checked=!1}),document.querySelector("#geometryFinish [value="+e.type+"]").checked=!0),this.initPreviewPath(t),this.enableClick()},this.clearMode=function(){console.log(" clear mode "),d3.selectAll(".define_helper").remove(),d3.select("#previewGeo").remove(),this._geometryType=null,this._newClick=!0,this._moveCenter=!1,this._moveVertex=!1,this._resizeCenter=!1,this._rotateCenter=!1,d3.select("#geometryFinish").style("visibility","hidden")},this.getNextId=function(){return this._validNextId++},this.initPreviewPath=function(e){if(console.log(" edit li init pos ",e),null==e)switch(this._geometryType){case"rect":for(e=[[200,200],[300,200],[300,300],[200,300]],o=0;o<e.length;o++)this.addVertexDot(e[o]);this.updatePreviewPath();break;case"circle":var t=[250,250];for(o=0;o<360;o+=30){var n=t[0]+50*Math.sin(Math.PI*o/180),i=t[1]+50*Math.cos(Math.PI*o/180);this.addVertexDot([n,i])}this.updatePreviewPath()}else{for(var o=0;o<e.length;o++)this.addVertexDot(e[o]);this.updatePreviewPath()}},this.updatePreviewPath=function(){var e=this.getGeometry();"polyline"!=this._geometryType&&e.push(e[0]),console.log(" liDot length ",e.length);var t=d3.line(),n=d3.select("#previewGeo");1==n.empty()&&(n=d3.select("#coversvg").append("path").attr("id","previewGeo").style("stroke",function(){return"gray"}).style("stroke-width","2px").style("stroke-dasharray","5 5").style("fill","none")),n.attr("d",t(e)),d3.selectAll(".define_circle").each(function(){d3.select(this).attr("originx",function(){return+d3.select(this).attr("cx")}).attr("originy",function(){return+d3.select(this).attr("cy")})}),this.updateCenterMoveDot(),this.updateBoundBoxMoveDots()},this.enableClick=function(){console.log(" enable click ",d3.select("#coversvg"),e._newClick),d3.select("#coversvg").on("mousedown",function(){console.log(" log click ");var t=d3.mouse(this);e._newClick&&e.addVertexDot(t)}).on("mousemove",function(){if(e._moveVertex&&null!=e._currectSelectId)d3.select("#"+e._currectSelectId).attr("cx",d3.mouse(this)[0]).attr("cy",d3.mouse(this)[1]),e.updatePreviewPath();else if(e._moveCenter&&null!=e._currectSelectId){var t=[+d3.select("#"+e._currectSelectId).attr("cx"),+d3.select("#"+e._currectSelectId).attr("cy")],n=[d3.mouse(this)[0]-t[0],d3.mouse(this)[1]-t[1]];e.moveVertexDots(n)}else if(e._resizeCenter&&null!=e._currectSelectId){var i=+d3.select("#"+e._currectSelectId).attr("originx"),o=+d3.select("#"+e._currectSelectId).attr("originy"),r=+d3.select("#boundbox_rect").attr("width"),a=+d3.select("#boundbox_rect").attr("height");n=[1+(d3.mouse(this)[0]-i)/r,1+(o-d3.mouse(this)[1])/a],console.log(" displayXY ",n),e.resizeVertexDots(n),d3.select("#"+e._currectSelectId).attr("cx",d3.mouse(this)[0]).attr("cy",d3.mouse(this)[1])}}).on("mouseup",function(){e._resizeCenter&&(d3.select("#"+e._currectSelectId).attr("originx",function(){return+d3.select(this).attr("cx")}).attr("originy",function(){return+d3.select(this).attr("cy")}),d3.selectAll(".define_circle").each(function(){d3.select(this).attr("originx",function(){return+d3.select(this).attr("cx")}).attr("originy",function(){return+d3.select(this).attr("cy")})})),null!=e._currectSelectId&&(e._currectSelectId=null),e._newClick=!0,e._moveCenter=!1,e._resizeCenter=!1,e._rotateCenter=!1,e._moveVertex=!1,e.updatePreviewPath()})},this.updateCenterMoveDot=function(){var t=this.getGeometry(),n=this.computeCentriod(t),i=d3.select("#centermove_circle");1==i.empty()&&(i=d3.select("#coversvg").append("circle").attr("id","centermove_circle").attr("class","define_helper").attr("r","2px").style("fill","blue").on("mousedown",function(){e._moveCenter=!0,e._newClick=!1,e._resizeCenter=!1,e._rotateCenter=!1,e._moveVertex=!1,e._currectSelectId=d3.select(this).attr("id")}).on("mouseenter",function(){d3.select(this).style("fill","red")}).on("mouseleave",function(){d3.select(this).style("fill","blue")})),i.attr("cx",n[0]).attr("cy",n[1])},this.updateBoundBoxMoveDots=function(){var t=this.getGeometry();if(console.log(" lidot ",t.length),!(t.length<=2)){var n=this.computeBoundbox(t),i=d3.select("#boundbox_rect"),o=d3.select("#resize_circle");1==i.empty()&&(i=d3.select("#coversvg").append("rect").attr("id","boundbox_rect").attr("class","define_helper").style("fill","none").style("stroke","red").style("stroke-width","1px").style("opacity","0.8"),o=d3.select("#coversvg").append("circle").attr("id","resize_circle").attr("class","define_helper").attr("r","2px").style("fill","orange").on("mousedown",function(){e._resizeCenter=!0,e._moveCenter=!1,e._newClick=!1,e._moveVertex=!1,e._rotateCenter=!1,e._currectSelectId=d3.select(this).attr("id")}).on("mouseenter",function(){d3.select(this).style("fill","red")}).on("mouseleave",function(){d3.select(this).style("fill","orange")})),i.attr("width",n.width).attr("height",n.height).attr("x",n.x).attr("y",n.y),o.attr("cx",n.x+n.width).attr("cy",n.y).attr("originx",n.x+n.width).attr("originy",n.y)}},this.computeCentriod=function(e){for(var t=[0,0],n=0;n<e.length;n++)t[0]+=e[n][0],t[1]+=e[n][1];return e.length>0&&(t[0]/=e.length,t[1]/=e.length),t},this.computeBoundbox=function(e){for(var t={left:1e5,right:0,top:1e5,bottom:0},n=0;n<e.length;n++)t.left>e[n][0]&&(t.left=e[n][0]),t.right<e[n][0]&&(t.right=e[n][0]),t.top>e[n][1]&&(t.top=e[n][1]),t.bottom<e[n][1]&&(t.bottom=e[n][1]);return{x:t.left,y:t.top,width:t.right-t.left,height:t.bottom-t.top}},this.moveVertexDots=function(e){d3.selectAll(".define_circle").each(function(){var t=+d3.select(this).attr("cx"),n=+d3.select(this).attr("cy");d3.select(this).attr("cx",t+e[0]).attr("cy",n+e[1])}),this.updatePreviewPath()},this.resizeVertexDots=function(e){var t=[+d3.select("#centermove_circle").attr("cx"),+d3.select("#centermove_circle").attr("cy")];d3.selectAll(".define_circle").each(function(){var n=+d3.select(this).attr("originx"),i=+d3.select(this).attr("originy");d3.select(this).attr("cx",t[0]+(n-t[0])*e[0]).attr("cy",t[1]+(i-t[1])*e[1])})},this.addVertexDot=function(t){console.log(" new circle ");var n="dot-"+e.getNextId();d3.select("#coversvg").append("circle").attr("class","define_circle define_helper").attr("id",function(){return n}).attr("r","3px").attr("cx",t[0]).attr("cy",t[1]).attr("originx",t[0]).attr("originy",t[1]).style("fill","green").on("mousedown",function(){e._moveVertex=!0,e._newClick=!1,e._moveCenter=!1,e._resizeCenter=!1,e._rotateCenter=!1,e._currectSelectId=d3.select(this).attr("id")}).on("mouseenter",function(){d3.select(this).style("fill","red")}).on("mouseleave",function(){console.log(" mouse leave !"),d3.select(this).style("fill","green")}),d3.select("#geometryFinish").style("visibility","visible")},this.getGeometry=function(){var e=[];return d3.selectAll(".define_circle").each(function(){e.push([+d3.select(this).attr("cx"),+d3.select(this).attr("cy")])}),e},this._init(),this}},function(e,t){e.exports=function(e){var t=this;return this._functionHub=e,this._currentMA={},this._liMAGeometry=[],this._init=function(){},this.addMAGeometry=function(e){return this._liMAGeometry.push(e),this.addAntDom(this._liMAGeometry.length-1),this._liMAGeometry.length-1},this.addAntDom=function(e){document.getElementById("antarea"),d3.selectAll(".antbutton").on("click",function(){var e=+d3.select(this).attr("index"),n=t._currentMA.path;if(null!=n){var i=t._functionHub._animateDomManager.getMetaInfobyIndex(e),o=t.getMAGeometrybyIndex(e).ant,r=i.antmodel;t.fitAnt(r,n,o.geotype,i.cenPosDisplace,i.normalLeft)}})},this.fitAnt=function(e,t,n,i,o){var r=t.geometry,a=(t.lengthperlist,1==o?t.liClockAngle_left:t.liClockAngle_right),l=1==o?t.liUniNormal_left:t.liUniNormal_right,s=e.clone(),c={x:r[0][0],y:r[0][1]};c.x+=i*l[0][0],c.y+=i*l[0][1],s.position=new Point(c.x,c.y),s.rotate(-a[0]);var u=[];s.segments.forEach(function(e){u.push([e.point._x,e.point._y])}),this.saveGeometryNew({type:"ant",geotype:"area"},u,s)},this.getMAGeometrybyIndex=function(e){if(e<this._liMAGeometry.length)return this._liMAGeometry[e]},this.updateGeometrybyEdit=function(e,t,n){var i=e[t];this.updateDom(i.dom,n);var o=this.computeLineSegInfoList(n),r=o.liUniNormal_left,a=o.liUniNormal_right,l=o.lengthPer,s=o.normalAngle,c=o.liUniNormal,u=this.computePerimeter(n);i={dom:i.dom,geometry:n,lengthperlist:l,normalanglelist:s,liUniNormal:c,liUniNormal_right:a,liUniNormal_left:r,liClockAngle_left:o.liClockAngle_left,liClockAngle_right:o.liClockAngle_right,perimeter:u},e[t]=i},this.saveGeometryNew=function(e,t,n,i){console.log(" SAVE ",e.type,t);for(var o="[",r=0;r<t.length;r++)o+="["+t[r][0]+","+t[r][1]+"],";o+="]",console.log(" liGeometry ",e.type,o);var a=document.getElementsByTagName("canvas");console.log("canvasid",n);var l=a[0].getBoundingClientRect(),s=[];for(r=0;r<t.length;r++){var c=t[r],u=(c[0],l.left,c[1]);u=[c[0],c[1]],s.push(u)}t=s;var d=$('input[name="geometrytype"]:checked').val();null!=e.type&&(d=e.type);var h=this.createDom(e.geotype,t,d),m=this.computeLineSegInfoList(t),f=m.liUniNormal_left,g=m.liUniNormal_right,p=m.lengthPer,y=m.normalAngle,v=m.liUniNormal,_=this.computePerimeter(t),M={geotype:e.geotype,dom:h,geometry:t,paperdom:i,lengthperlist:p,normalanglelist:y,liUniNormal:v,liUniNormal_right:g,liUniNormal_left:f,liClockAngle_left:m.liClockAngle_left,liClockAngle_right:m.liClockAngle_right,perimeter:_};this._currentMA[d]=M,console.log(" current ma ",this._currentMA)},this.fakeGeometryNew=function(e,t,n){var i=n,o={type:e,dom:this.createDom(e,t,i),geometry:t,lengthperlist:this.computeLengthPerList(t),perimeter:this.computePerimeter(t)};this._currentMA[i]=o},this.getCurrentMAGeometry=function(){if(null!=this._currentMA.path)return this._currentMA},this.clearCurrentMAGeometry=function(){this._currentMA={}},this.setCurrentMAGeometry=function(e){for(var t=Object.keys(this._currentMA),n=0;n<t.length;n++){var i=t[n];this._currentMA[i].dom.remove()}this._currentMA=e},this.setVisibleofGeometries=function(e){d3.selectAll(".define_geometry").style("visibility",function(e){return 1==e?"visible":"hidden"})},this.updateDom=function(e,t){if(0==e.empty()){var n=d3.line();e.attr("d",n(t))}return e},this.createDom=function(e,t,n){switch(e){case"polyline":var i=d3.line();return d3.select("#coversvg").append("path").attr("d",i(t)).attr("class",n+" define_geometry").style("stroke",function(){return"path"==n?"#03A9F4":"boundary"==n?"gray":"ant"==n?"black":void 0}).style("stroke-width","2px").style("fill","none");case"area":case"rect":case"circle":return console.log(" create area "),i=d3.line(),t.push(t[0]),d3.select("#coversvg").append("path").attr("class",n+" define_geometry").attr("d",i(t)).style("fill",function(){return"none"}).style("stroke",function(){return"path"==n?"#03A9F4":"boundary"==n?"orange":"ant"==n?"black":void 0})}return null},this.computePerimeter=function(e){for(var t=0,n=0;n<e.length-1;n++){var i=e[n],o=e[n+1];t+=Math.sqrt((i[0]-o[0])*(i[0]-o[0])+(i[1]-o[1])*(i[1]-o[1]))}return t},this.computeLineSegInfoList=function(e){for(var t=[],n=[0],i=[],o=[],r=[],a=[],l=[],s=[],c=0,u=0;u<e.length-1;u++){var d=e[u],h=e[u+1];c+=I=Math.sqrt((d[0]-h[0])*(d[0]-h[0])+(d[1]-h[1])*(d[1]-h[1])),t.push(I);var m={x:d[1]-h[1],y:h[0]-d[0]},f={x:-m.x,y:-m.y},g=m,p=Math.sqrt(g.x*g.x+g.y*g.y),y=[f.x/p,f.y/p],v=180*Math.acos(y[0])/Math.PI;y[1]>0&&(v=360-v),l.push(v);var _=[-y[0],-y[1]],M=180*Math.acos(_[0])/Math.PI;_[1]>0&&(M=360-M),s.push(M),o.push(y),r.push(y),a.push(_),g.y<0&&(g={x:-g.x,y:-g.y});var b=180*Math.acos(g.x/p)/Math.PI;i.push(b-90)}var I=0;for(u=0;u<t.length;u++)I+=t[u],n.push(I/c);return{lengthPer:n,normalAngle:i,liUniNormal:o,liUniNormal_left:r,liUniNormal_right:a,liClockAngle_left:l,liClockAngle_right:s}},this.computeLengthPerList=function(e){for(var t=[],n=[0],i=0,o=0;o<e.length-1;o++){var r=e[o],a=e[o+1];i+=l=Math.sqrt((r[0]-a[0])*(r[0]-a[0])+(r[1]-a[1])*(r[1]-a[1])),t.push(l)}var l=0;for(o=0;o<t.length;o++)l+=t[o],n.push(l/i);return n},this.setMAGeometryVisible=function(e,t){for(var n=1==t?"visible":"hidden",i=Object.keys(e),o=0;o<i.length;o++)e[i[o]].dom.style("visibility",n)},this._init(),this}},function(e,t,n){n(0),n(1),n(2);var i=n(6),o=(n(3),n(4),!1),r=!1;window.loadMa=function(e,t){d3.json(e,function(e,n){(e&&console.log(e),console.log("json",n),console.log("loadcanvas",t),null==t)&&((o=document.createElement("canvas")).width=800,o.height=800,o.id="hhhcanvas",t=o.id,document.body.append(o));if(null!=t)var o=document.getElementById(t);console.log("canvas",o),paper.setup(o),paper.install(window),this._functionHub=i();for(var r=n.magroups,a=n.drawpath,l=Object.keys(r),s=0;s<l.length;s++){var c=l[s];this._functionHub.addMAbyGroupInfo(r[c],a,t)}this._functionHub._type="animate",this._functionHub.initFunc()})},window.MA_Start=function(){o=!0},window.MA_End=function(){r=!0},window.marchingAnt=function(e,t,n,a,l,s,c,u){1==o&&(this._functionHub=i(),o=!1);var d=[],h={},m={};if(1==u){var f=function(e,t){for(var n=new paper.Path,i=0;i<e.length;i++)n.add(new Point(e[i]));return n.closed=t,n}(e,!0);f.visible=!1;var g={dots:n},p={dots:t};d.push({boundary:g,path:p}),h.antinterval=a}else{var y=document.getElementsByTagName("canvas")[0];paper.setup(y),paper.install(window);p={geotype:"line",dots:t};var v={geotype:"area",dots:e};g={geotype:"area",dots:n};d.push({path:p,ant:v,boundary:g}),h.antinterval=30-a}h.ae="MA",h.antcolor=c,h.antgap=l,h.groupid=s,h.antshape="self-defined",m.malist=d,m.mainfo=h,null!=f?this._functionHub.addMAbyGroupwithExampleAnt(m,f):(void 0,this._functionHub.addMAbyGroupInfo(m,void 0,y.id)),1==r&&(this._functionHub._type="animate",this._functionHub.initFunc(),r=!1)}},function(e,t,n){var i=n(0),o=n(1),r=n(2),a=n(3),l=n(4);e.exports=function(e){var t=this;return this._type=null,this._para=null,this._currentMAGeometryId=null,this._currentIntervalId=null,this._liHiddenMAIndex=[],this._liStoreMAIndex=[],this._init=function(e){console.log(" init funcHub"),this._geometryDefiner=new a,this._geometrySaver=new l(this),this._animateEditor=new o(this),this._animateEnhancer=new r,this._animateDomManager=new i(this),this._initLocal("22")},this._initLocal=function(e){(new FormData).append("name",e)},this.successSaveFunc=function(e,t){console.log("success save! ",e)},this.successFetchFunc=function(e,t){if(null!=e.ma){console.log("responsema",e.ma),document.getElementById("saveMAName").value=e.ma.name;var n=e.ma.magroups,i=e.ma.drawpath;console.log(" draw Path ",i);var o=Object.keys(n);console.log("liGroupId",o);for(var r=0;r<o.length;r++){var a=o[r];t.addMAbyGroupInfo(n[a],i)}t._type="animate",t.initFunc(),console.log(" success fetched ! ",e)}},this.addMAbyGroupwithExampleAnt=function(e,t,n){var i=e.mainfo,o=e.malist,r=["path","boundary"];if(null!=o)for(var a=0;a<o.length;a++){for(var l=o[a],s=0;s<r.length;s++){var c=r[s];null!=l[c]&&(this._geometrySaver.saveGeometryNew({type:c,geotype:l[c].geoType},l[c].dots),new Path(l[c].dots))}if(null!=n){console.log(" darw Path ",l.path.dots);var u=new Path({segments:l.path.dots});u.strokeColor="#dddddd",u.strokeWidth=.2}var d=this._geometrySaver.getCurrentMAGeometry().path;this._geometrySaver.fitAnt(t,d,"area",0,!1),d3.selectAll(".define_geometry").style("visibility","hidden");var h=this._geometrySaver.getCurrentMAGeometry(),m=this._geometrySaver.addMAGeometry(h);this._liStoreMAIndex.push(m);var f=this._animateEnhancer.activateDOM(h,i).metainfo;this._geometrySaver.clearCurrentMAGeometry(),this._animateDomManager.addMetaInfo(m,f),this._animateEditor.addMADoms(m,f)}},this.addMAbyGroupInfo=function(e,t,n){console.log("groupma",e);var i=e.malist,o=e.mainfo;if(null!=i)for(var r=["path","ant","boundary"],a=0;a<i.length;a++){for(var l=i[a],s=0;s<r.length;s++){var c=r[s];null!=l[c]&&(console.log(" create geo ",l[c].dots),this._geometrySaver.saveGeometryNew({type:c,geotype:l[c].geoType},l[c].dots,n))}var u=this._geometrySaver.getCurrentMAGeometry();console.log(" MAGeometryInfo ",u,o);var d=this._geometrySaver.addMAGeometry(u);this._liStoreMAIndex.push(d);var h=this._animateEnhancer.activateDOM(u,o).metainfo;this._geometrySaver.clearCurrentMAGeometry(),this._animateDomManager.addMetaInfo(d,h),this._animateEditor.addMADoms(d,h)}},this.setFunc=function(e){this._type=e.type,null!=e.para&&(this._para=e.para),console.log(" function hub ",this._type,this._para),this.initFunc()},this.setMAVisiblebyIndex=function(e,t){e?this._liHiddenMAIndex.splice(this._liHiddenMAIndex.indexOf(t),1):-1==this._liHiddenMAIndex.indexOf(t)&&this._liHiddenMAIndex.push(t)},this.stopFunc=function(e){switch(e.type){case"animate":this.setMAVisiblebyIndex(!1,e.para.maIndex)}},this.initFunc=function(){switch(this._type){case"new":case"editGeometry":this._geometryDefiner.beginMode(this._para);break;case"addGeometry":console.log(" add geo! ",this._para,this._geometryDefiner.getGeometry()),this._geometrySaver.saveGeometryNew(this._para,this._geometryDefiner.getGeometry()),this._geometryDefiner.clearMode();break;case"newadd":this._geometryDefiner.clearMode(),this._type="editanimate",this.initFunc();break;case"editanimate":console.log(" [2] begin ! edit animte ",this._currentMAGeometryId),this._animateEditor.editAnimate();break;case"stopani":console.log(" stop animate "),clearInterval(t._currentIntervalId);break;case"animate":var e=0;clearInterval(t._currentIntervalId),t._currentIntervalId=setInterval(function(){var n=t._animateDomManager.getMetaInfos();console.log("mapMetaInfo",n);var i=Object.keys(n);console.log("liMAIndex",i);for(var o=0;o<i.length;o++){var r=+i[o];console.log("maIndex",r);var a=t._animateDomManager.getMetaInfobyIndex(r);console.log("initfuncmetainfo",a);var l=a.antinterval;if(!(e%l>0)){var s=a.antoffsets,c=(a.antmodel,a.antwidth),u=(a.cenPosDisplace,a.perimeter),d=a.antgap,h=[];s.sort(function(e,t){return e-t});for(var m=0;m<s.length;m++){var f=s[m],g=t._animateDomManager.getAnt(r,f);if(g.visible=!1,(f+=1)>u+c/2)g.visible=!1;else if(!(t._liHiddenMAIndex.indexOf(r)>=0)){if(0==m&&f>=d-c/2){var p=-c/2;t._animateDomManager.getAnt(r,p).visible=!0,h.push(p)}t._animateDomManager.getAnt(r,f).visible=!0,h.push(f)}}a.antoffsets=h,t._animateDomManager.updateMetaInfo(r,a)}}e>1e6?e=0:e+=1},10);break;case"upload":for(var n="[",i=this._geometryDefiner.getGeometry(),o=0;o<i.length;o++)o==i.length-1?n+="["+i[o][0]+","+i[o][1]+"]":n+="["+i[o][0]+","+i[o][1]+"],";n+="]",alert(n);break;case"saveDB":var r=document.getElementById("saveMAName").value,a={};a.name=r;var l=t._animateDomManager.getMetaInfos();console.log(" save to db ",Object.keys(l).length,t._liStoreMAIndex);var s={};for(var c in l){var u={},d=t._geometrySaver.getMAGeometrybyIndex(c),h=l[c];null!=d.path&&(u.path={geotype:d.path.geotype,dots:d.path.geometry}),null!=d.ant&&(u.ant={geotype:d.ant.geotype,dots:d.ant.geometry}),null!=d.boundary&&(u.boundary={geotype:d.boundary.geotype,dots:d.boundary.geometry});var m=h.groupid;if(null==s[m]){var f={ae:"MA",groupid:m,antgap:h.antgap,antcolor:h.antcolor,antshape:"self-defined",antinterval:h.antinterval},g=[u];s[m]={mainfo:f,malist:g}}else console.log(" add! "),s[m].malist.push(u)}a.magroups=s;var p=new FormData;p.append("ma",JSON.stringify(a)),lSendUrl("POST","http://localhost:20082/saveMA",p,this.successSaveFunc,this)}},this._init(e),this}}]);